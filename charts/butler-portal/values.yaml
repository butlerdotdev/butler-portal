# Butler Portal Helm values
# https://github.com/butlerdotdev/butler-portal

replicaCount: 1

image:
  repository: ghcr.io/butlerdotdev/butler-portal
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

service:
  type: ClusterIP
  port: 7007

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: portal.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []

resources:
  limits:
    cpu: "2"
    memory: 1Gi
  requests:
    cpu: 250m
    memory: 512Mi

nodeSelector: {}
tolerations: []
affinity: {}

# Backstage app-config overrides
# These are injected as environment variables into the portal pod
appConfig:
  # Base URL for the portal (frontend + backend)
  baseUrl: http://localhost:7007
  # Auth provider (guest for dev, configure OIDC for production)
  auth:
    provider: guest

# PostgreSQL via CloudNativePG
# Requires the CNPG operator to be installed in the cluster
postgresql:
  enabled: true
  # CNPG Cluster resource configuration
  instances: 1
  storage:
    size: 10Gi
    storageClass: ""
  walStorage:
    enabled: false
    size: 2Gi
    storageClass: ""
  # Database and owner created via initdb bootstrap
  database: butler_portal
  owner: butler_portal
  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: "1"
      memory: 512Mi

# Registry configuration
registry:
  # Base URL for the registry (e.g. https://portal.butlerlabs.dev)
  baseUrl: ""
  # GitHub token secret reference for repository_dispatch and commit status
  github:
    # Name of the K8s Secret containing the GitHub PAT
    secretName: ""
    # Key within the Secret
    secretKey: "token"

# Extra environment variables to add to the deployment
extraEnv: []
# - name: AUTH_GOOGLE_CLIENT_ID
#   valueFrom:
#     secretKeyRef:
#       name: google-auth
#       key: clientId
